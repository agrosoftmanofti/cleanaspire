

<MudDialog>
    <DialogContent>
        <EditForm @ref="editForm" Model="@model" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator />
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="model.Sku" For="@(() => model.Sku)"
                    Label="@L["SKU"]" Placeholder="@L["SKU"]"
                    Required="true" RequiredError="@L["Sku is required"]">
                    </MudTextField>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="model.Name" For="@(() => model.Name)"
                    Label="@L["Name"]" Placeholder="@L["Name"]"
                    Required="true" RequiredError="@L["Name is required"]">
                    </MudTextField>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="model.Category" For="@(() => model.Category)"
                    Label="@L["Category"]" Placeholder="@L["Category"]"
                    Required="true" RequiredError="@L["Category is required"]">
                    </MudTextField>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudTextField @bind-Value="model.Uom" For="@(() => model.Uom)"
                    Label="@L["UOM"]" Placeholder="@L["Uom"]"
                    Required="false" RequiredError="@L["Uom is required"]">
                    </MudTextField>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudNumericField @bind-Value="model.Price" For="@(() => model.Price)"
                    Label="@L["Price"]" Placeholder="@L["Price"]"
                    Required="true" RequiredError="@L["Price is required"]">
                    </MudNumericField>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudNumericField @bind-Value="model.Currency" For="@(() => model.Currency)"
                    Label="@L["Currency"]" Placeholder="@L["Currency"]"
                    Required="true" RequiredError="@L["Currency is required"]">
                    </MudNumericField>
                </MudItem>
                <MudItem xs="12" md="12">
                    <MudTextField @bind-Value="model.Description" For="@(() => model.Description)"
                    Label="@L["Description"]" Placeholder="@L["Description"]">
                    </MudTextField>
                </MudItem>
            </MudGrid>
        </EditForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@L["Cancel"]</MudButton>
        <MudButton OnClick="Submit">@L["Save"]</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance MudDialog { get; set; } = default!;
    private CreateProductCommand model = new CreateProductCommand();
    private EditForm editForm=default!;
    private void Cancel() => MudDialog.Cancel();
    private async Task Submit(){

        if (editForm?.EditContext?.Validate() == true)
        {
            await OnValidSubmit();
        }
        MudDialog.Close(DialogResult.Ok(true));
    }
    private async Task OnValidSubmit()
    {
        try
        {
            await ApiClient.Products.PostAsync(model);
        }
        catch (ApiException e){
            Logger.LogError(e, e.Message);
            Snackbar.Add(L["Failed to create product."], Severity.Error);
        }
        catch (Exception e)
        {
            Logger.LogError(e, e.Message);
            Snackbar.Add(L["An error occurred while creating the product."], Severity.Error);
        };
    }
}
